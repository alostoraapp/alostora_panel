version: "3.9"

networks:
  default:
    name: web_net

services:
  nginx:
    # We pull the pre-built image from GitHub Container Registry
    # !!! IMPORTANT: Replace 'alostoraapp/alostora_panel'
    # with your GitHub <username_or_org>/<repository_name>
    image: ghcr.io/alostoraapp/alostora_panel:latest
    container_name: admin_panel
    restart: on-failure

    # The app files are baked into the image, so no volume is needed here.

    networks:
      - default

    labels:
      # Your Traefik labels remain unchanged
      - "traefik.enable=true"
      - "traefik.docker.network=web_net"
      - "traefik.http.routers.webapp.entrypoints=http"
      - "traefik.http.routers.webapp.rule=Host(`panel.alostora.org`)"
      - "traefik.http.routers.webapp.service=webapp-secure"
      - "traefik.http.routers.webapp.middlewares=https-redirect"
      - "traefik.http.routers.webapp-secure.entrypoints=https"
      - "traefik.http.routers.webapp-secure.rule=Host(`panel.alostora.org`)"
      - "traefik.http.routers.webapp-secure.tls=true"
      - "traefik.http.routers.webapp-secure.tls.options=default"
      - "traefik.http.routers.webapp-secure.tls.certresolver=mycert"
      - "traefik.http.routers.webapp-secure.service=webapp-secure"
      - "traefik.http.services.webapp-secure.loadbalancer.server.port=80"
      - "traefik.http.middlewares.redirect-to-non-www.redirectregex.permanent=true"

# The 'admin_panel' volume is no longer used by the nginx service
# If nothing else uses this, you can remove this block.
# If you remove it, also remove the 'docker volume rm' command in production.yaml
volumes:
  admin_panel: